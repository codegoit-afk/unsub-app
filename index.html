<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>UnSub App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* --- –ó–ê–ì–ê–õ–¨–ù–Ü –°–¢–ò–õ–Ü --- */
        :root {
            --bg-color: #121216;
            --text-main: #ffffff;
            --card-bg: #1e1e24;
            --primary: #6c5ce7;
            --success: #00b894;
            --text-sec: #a0a0b0;
            --danger: #ff7675;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- –ó–ê–°–¢–ê–í–ö–ê --- */
        #splash-screen {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background-color: var(--bg-color);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 9999; transition: opacity 0.6s ease-out, visibility 0.6s;
        }
        #splash-screen.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
        .logo-title {
            font-size: 42px; font-weight: 800; letter-spacing: -1px;
            background: linear-gradient(45deg, #6c5ce7, #a29bfe);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 10px; animation: popIn 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .logo-subtitle {
            font-size: 12px; font-weight: 300; color: #666; letter-spacing: 1px;
            opacity: 0; animation: fadeIn 1s ease-in forwards; animation-delay: 0.5s;
        }
        @keyframes popIn { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes fadeIn { to { opacity: 1; color: var(--text-sec); } }

        /* --- –ì–û–õ–û–í–ù–ò–ô –ï–ö–†–ê–ù --- */
        .app-container {
            width: 100%; max-width: 100%; padding: 16px; box-sizing: border-box;
            display: flex; flex-direction: column; height: 100%;
            opacity: 0; transition: opacity 0.5s;
        }
        .app-container.visible { opacity: 1; }

        .static-header { flex-shrink: 0; }
        
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        
        /* –ö–Ω–æ–ø–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .stats-btn {
            background: var(--card-bg); border: 1px solid #333; color: var(--text-main);
            width: 40px; height: 40px; border-radius: 12px; display: flex;
            align-items: center; justify-content: center; cursor: pointer; font-size: 20px;
            transition: 0.2s;
        }
        .stats-btn:active { transform: scale(0.95); background: #333; }

        .savings-label { font-size: 11px; color: var(--text-sec); letter-spacing: 0.5px; text-transform: uppercase; }
        .amount { font-size: 26px; font-weight: 800; color: var(--primary); margin-top: 2px; }

        .search-bar {
            background: var(--card-bg); border: 1px solid transparent; border-radius: 12px;
            padding: 12px 12px 12px 40px; width: 100%; color: var(--text-main);
            box-sizing: border-box; margin-bottom: 10px; font-size: 16px; outline: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23a0a0b0' viewBox='0 0 16 16'%3E%3Cpath d='M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat; background-position: 12px center;
        }
        
        .filters { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px; margin-bottom: 10px; scrollbar-width: none; }
        .chip {
            background: var(--card-bg); padding: 8px 14px; border-radius: 18px; font-size: 13px;
            white-space: nowrap; cursor: pointer; border: 1px solid transparent; color: var(--text-main); transition: 0.2s;
        }
        .chip.active { background: var(--primary); color: #fff; box-shadow: 0 4px 12px rgba(108, 92, 231, 0.3); }

        .service-list-wrapper { flex-grow: 1; overflow-y: auto; padding-bottom: 100px; -webkit-overflow-scrolling: touch; }
        .service-card {
            background: var(--card-bg); border-radius: 16px; padding: 12px;
            display: flex; align-items: center; cursor: pointer; margin-bottom: 8px;
            transition: transform 0.1s, background-color 0.2s;
        }
        .service-card:active { transform: scale(0.98); background-color: #25252b; }
        .service-icon {
            width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center;
            margin-right: 12px; flex-shrink: 0; background-color: #2d2d35; overflow: hidden; position: relative;
        }
        .service-icon img { width: 100%; height: 100%; object-fit: cover; transition: opacity 0.3s; }
        .service-info { flex-grow: 1; overflow: hidden; }
        .service-name { font-weight: 600; font-size: 15px; margin-bottom: 3px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .service-meta { display: flex; align-items: center; font-size: 12px; color: var(--text-sec); }
        .tag { padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; text-transform: uppercase; margin-right: 6px; }

        /* –ö–æ–ª—å–æ—Ä–∏ —Ç–µ–≥—ñ–≤ */
        .tag.prod { background: rgba(162, 155, 254, 0.15); color: #a29bfe; }
        .tag.music { background: rgba(116, 185, 255, 0.15); color: #74b9ff; }
        .tag.stream { background: rgba(255, 118, 117, 0.15); color: #ff7675; }
        .tag.game { background: rgba(85, 239, 196, 0.15); color: #55efc4; }
        .tag.other { background: rgba(253, 203, 110, 0.15); color: #fdcb6e; }
        .tag.sec { background: rgba(99, 110, 114, 0.3); color: #b2bec3; }
        .tag.edu { background: rgba(250, 177, 160, 0.15); color: #fab1a0; }

        /* --- –ú–û–î–ê–õ–¨–ù–Ü –í–Ü–ö–ù–ê --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(4px);
            display: flex; align-items: flex-end; opacity: 0; pointer-events: none;
            transition: opacity 0.2s; z-index: 1000;
        }
        .modal-overlay.open { opacity: 1; pointer-events: all; }

        .modal {
            background: #18181b; width: 100%; padding: 24px;
            border-top-left-radius: 24px; border-top-right-radius: 24px;
            transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            box-shadow: 0 -10px 40px rgba(0,0,0,0.5); border-top: 1px solid #333;
            max-height: 90vh; overflow-y: auto;
        }
        .modal-overlay.open .modal { transform: translateY(0); }

        .modal-header { text-align: center; margin-bottom: 24px; }
        .modal-img-container {
            width: 64px; height: 64px; border-radius: 18px; background: #2d2d35; 
            margin: 0 auto 12px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        .modal-img { width: 100%; height: 100%; object-fit: cover; }
        .modal h2 { margin: 0; font-size: 22px; font-weight: 700; color: white; }
        .modal p { margin: 4px 0 0; color: var(--primary); font-size: 14px; font-weight: 500; }

        /* –ï–ª–µ–º–µ–Ω—Ç–∏ —Ñ–æ—Ä–º–∏ */
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px; }
        .form-group { margin-bottom: 16px; }
        .form-label { display: block; margin-bottom: 8px; color: var(--text-sec); font-size: 11px; font-weight: 700; letter-spacing: 0.8px; text-transform: uppercase; }
        
        .form-control {
            width: 100%; background: #27272a; border: 1px solid #3f3f46; color: var(--text-main);
            padding: 14px; border-radius: 12px; font-size: 16px; outline: none; box-sizing: border-box;
            transition: all 0.2s; -webkit-appearance: none;
        }
        .form-control:focus { border-color: var(--primary); background: #2d2d35; }

        /* –°—Ç–∏–ª—å —á–µ–∫–±–æ–∫—Å–∞ –¥–ª—è —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è */
        .checkbox-wrapper {
            display: flex; align-items: center; background: #27272a;
            padding: 12px; border-radius: 12px; border: 1px solid #3f3f46; cursor: pointer;
        }
        .checkbox-wrapper input { margin-right: 12px; accent-color: var(--success); width: 18px; height: 18px; }
        .checkbox-text { font-size: 14px; font-weight: 500; }
        
        /* –ö–Ω–æ–ø–∫–∏ */
        .btn-confirm {
            width: 100%; padding: 16px; border-radius: 14px; border: none;
            font-weight: 700; font-size: 16px; cursor: pointer;
            background: linear-gradient(135deg, var(--primary), #a29bfe); 
            color: #fff; margin-top: 10px;
            box-shadow: 0 4px 15px rgba(108, 92, 231, 0.4);
            transition: transform 0.1s;
        }
        .btn-confirm:active { transform: scale(0.98); }

        .btn-cancel {
            width: 100%; padding: 14px; background: transparent; border: none; color: var(--text-sec);
            font-size: 15px; cursor: pointer; margin-top: 5px; font-weight: 500;
        }

        /* --- –í–Ü–ö–ù–û –°–¢–ê–¢–ò–°–¢–ò–ö–ò --- */
        .stats-card {
            background: #25252b; border-radius: 16px; padding: 20px; margin-bottom: 12px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .stats-label { color: var(--text-sec); font-size: 13px; margin-bottom: 4px; }
        .stats-value { font-size: 24px; font-weight: 800; color: white; }
        .stats-value.saved { color: var(--success); }
        .stats-icon { font-size: 24px; background: #333; width: 48px; height: 48px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }

    </style>
</head>
<body>

<div id="splash-screen">
    <div class="logo-title">UnSub</div>
    <div class="logo-subtitle">developed by Code&Go</div>
</div>

<div class="app-container" id="main-app">
    <div class="static-header">
        <header>
            <div>
                <div class="savings-label">–ú–Ü–°–Ø–ß–ù–Ü –í–ò–¢–†–ê–¢–ò</div>
                <div class="amount" id="headerAmount">$0</div>
            </div>
            <div class="stats-btn" onclick="openStats()">
                üìä
            </div>
        </header>
        <input type="text" id="searchInput" class="search-bar" placeholder="–ü–æ—à—É–∫ —Å–µ—Ä–≤—ñ—Å—ñ–≤...">
        
        <div class="filters">
            <div class="chip active" onclick="activateFilter('all', this)">–í—Å—ñ</div>
            <div class="chip" onclick="activateFilter('stream', this)">–°—Ç—Ä—ñ–º—ñ–Ω–≥</div>
            <div class="chip" onclick="activateFilter('music', this)">–ú—É–∑–∏–∫–∞</div>
            <div class="chip" onclick="activateFilter('game', this)">–Ü–≥—Ä–∏</div>
            <div class="chip" onclick="activateFilter('prod', this)">–†–æ–±–æ—Ç–∞</div>
            <div class="chip" onclick="activateFilter('edu', this)">–ù–∞–≤—á–∞–Ω–Ω—è</div>
            <div class="chip" onclick="activateFilter('sec', this)">VPN/–ó–∞—Ö–∏—Å—Ç</div>
        </div>
    </div>

    <div class="service-list-wrapper">
        <div id="servicesList"></div>
    </div>
</div>

<div class="modal-overlay" id="reminderModal">
    <div class="modal">
        <div class="modal-header">
            <div class="modal-img-container">
                <img id="modalImg" class="modal-img" src="" alt="">
            </div>
            <h2 id="modalTitle">Netflix</h2>
            <p>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</p>
        </div>
        
        <div class="form-grid">
            <div class="form-group">
                <label class="form-label">–¶—ñ–Ω–∞ ($)</label>
                <input type="number" class="form-control" id="priceInput" placeholder="0.00">
            </div>
            <div class="form-group">
                <label class="form-label">–¶–∏–∫–ª</label>
                <select class="form-control" id="cycleInput">
                    <option value="month">–©–æ–º—ñ—Å—è—Ü—è</option>
                    <option value="year">–©–æ—Ä–æ–∫—É</option>
                </select>
            </div>
        </div>

        <div class="form-grid">
            <div class="form-group">
                <label class="form-label">–î–∞—Ç–∞ –æ–ø–ª–∞—Ç–∏</label>
                <input type="date" class="form-control" id="dateInput">
            </div>
            <div class="form-group">
                <label class="form-label">–ß–∞—Å (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)</label>
                <input type="time" class="form-control" id="timeInput"> 
            </div>
        </div>

        <div class="form-group">
            <label class="checkbox-wrapper">
                <input type="checkbox" id="unsubCheckbox">
                <span class="checkbox-text">–Ø —Å–∫–∞—Å—É–≤–∞–≤ –ø—ñ–¥–ø–∏—Å–∫—É (–í—Ä–∞—Ö—É–≤–∞—Ç–∏ —è–∫ –µ–∫–æ–Ω–æ–º—ñ—é)</span>
            </label>
        </div>

        <button class="btn-confirm" onclick="saveSubscription()">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
        <button class="btn-cancel" onclick="closeModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
    </div>
</div>

<div class="modal-overlay" id="statsModal">
    <div class="modal">
        <h2 style="text-align: center; margin-bottom: 20px;">–§—ñ–Ω–∞–Ω—Å–æ–≤–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
        
        <div class="stats-card">
            <div>
                <div class="stats-label">–©–æ–º—ñ—Å—è—á–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏</div>
                <div class="stats-value" id="statsExpenses">$0</div>
            </div>
            <div class="stats-icon">üí∏</div>
        </div>

        <div class="stats-card" style="border: 1px solid var(--success);">
            <div>
                <div class="stats-label" style="color: var(--success);">–ó–∞–æ—â–∞–¥–∂–µ–Ω–æ –Ω–∞ –º—ñ—Å—è—Ü—å</div>
                <div class="stats-value saved" id="statsSavings">$0</div>
            </div>
            <div class="stats-icon" style="background: rgba(0, 184, 148, 0.2);">üê∑</div>
        </div>

        <div class="stats-card">
            <div>
                <div class="stats-label">–†—ñ—á–Ω–∏–π –ø—Ä–æ–≥–Ω–æ–∑ –≤–∏—Ç—Ä–∞—Ç</div>
                <div class="stats-value" id="statsYearly">$0</div>
            </div>
            <div class="stats-icon">üìÖ</div>
        </div>

        <button class="btn-cancel" onclick="closeStats()">–ó–∞–∫—Ä–∏—Ç–∏</button>
        <button class="btn-cancel" onclick="resetData()" style="color: #ff7675; font-size: 12px;">–°–∫–∏–Ω—É—Ç–∏ –≤—Å—ñ –¥–∞–Ω—ñ</button>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // –ì–õ–û–ë–ê–õ–¨–ù–Ü –ó–ú–Ü–ù–ù–Ü –°–¢–ê–ù–£
    let currentFilter = 'all';
    let currentSearch = '';

    // –ó–∞–ø—É—Å–∫ + –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö
    window.onload = function() {
        setTimeout(() => {
            document.getElementById('splash-screen').classList.add('hidden');
            document.getElementById('main-app').classList.add('visible');
        }, 2000);
        loadUserData(); // –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ —Ü–∏—Ñ—Ä–∏
        renderServices(); // –ú–∞–ª—é—î–º–æ —Å–µ—Ä–≤—ñ—Å–∏
    };

    // --- –õ–û–ö–ê–õ–¨–ù–ê –ü–ê–ú'–Ø–¢–¨ (–Ü–º—ñ—Ç–∞—Ü—ñ—è –ë–∞–∑–∏ –î–∞–Ω–∏—Ö) ---
    let userData = {
        expenses: 0,
        savings: 0,
        subscriptions: [] 
    };

    function loadUserData() {
        const saved = localStorage.getItem('unsub_data');
        if (saved) {
            userData = JSON.parse(saved);
            updateUI();
        }
    }

    function saveToLocal() {
        localStorage.setItem('unsub_data', JSON.stringify(userData));
        updateUI();
    }

    function updateUI() {
        // –û–Ω–æ–≤–ª—é—î–º–æ —à–∞–ø–∫—É
        document.getElementById('headerAmount').innerText = `$${userData.expenses}`;
        
        // –û–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        document.getElementById('statsExpenses').innerText = `$${userData.expenses}`;
        document.getElementById('statsSavings').innerText = `$${userData.savings}`;
        document.getElementById('statsYearly').innerText = `$${userData.expenses * 12}`;
    }

    function resetData() {
        if(confirm("–í–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –¥–∞–Ω—ñ?")) {
            userData = { expenses: 0, savings: 0, subscriptions: [] };
            saveToLocal();
            closeStats();
        }
    }

    // --- –ë–ê–ó–ê –°–ï–†–í–Ü–°–Ü–í (–í—Å—ñ —Ç–≤–æ—ó —Å–µ—Ä–≤—ñ—Å–∏) ---
    const servicesData = [
        { name: "Netflix", type: "stream", domain: "netflix.com" },
        { name: "YouTube Premium", type: "stream", domain: "youtube.com" },
        { name: "Apple TV+", type: "stream", domain: "tv.apple.com" },
        { name: "Hulu", type: "stream", domain: "hulu.com" },
        { name: "Disney+", type: "stream", domain: "disneyplus.com" },
        { name: "HBO Max", type: "stream", domain: "hbomax.com" },
        { name: "Prime Video", type: "stream", domain: "primevideo.com" },
        
        { name: "Spotify", type: "music", domain: "spotify.com" },
        { name: "Apple Music", type: "music", domain: "music.apple.com" },
        { name: "YouTube Music", type: "music", domain: "music.youtube.com" },
        { name: "SoundCloud", type: "music", domain: "soundcloud.com" },
        { name: "Tidal", type: "music", domain: "tidal.com" },
        
        { name: "PlayStation Plus", type: "game", domain: "playstation.com" },
        { name: "Xbox Game Pass", type: "game", domain: "xbox.com" },
        { name: "Discord Nitro", type: "game", domain: "discord.com" },
        { name: "Steam", type: "game", domain: "store.steampowered.com" },
        { name: "EA Play", type: "game", domain: "ea.com" },
        
        { name: "ChatGPT Plus", type: "prod", domain: "openai.com" },
        { name: "Adobe Cloud", type: "prod", domain: "adobe.com" },
        { name: "Canva", type: "prod", domain: "canva.com" },
        { name: "Figma", type: "prod", domain: "figma.com" },
        { name: "Microsoft 365", type: "prod", domain: "microsoft.com" },
        { name: "Zoom", type: "prod", domain: "zoom.us" },
        
        { name: "Duolingo", type: "edu", domain: "duolingo.com" },
        { name: "Coursera", type: "edu", domain: "coursera.org" },
        { name: "Udemy", type: "edu", domain: "udemy.com" },
        
        { name: "NordVPN", type: "sec", domain: "nordvpn.com" },
        { name: "ExpressVPN", type: "sec", domain: "expressvpn.com" },
        { name: "1Password", type: "sec", domain: "1password.com" },
        
        { name: "Tinder", type: "other", domain: "tinder.com" },
        { name: "Bumble", type: "other", domain: "bumble.com" },
        { name: "Glovo", type: "other", domain: "glovoapp.com" }
    ];

    const typeNames = { stream: "–°—Ç—Ä—ñ–º—ñ–Ω–≥", music: "–ú—É–∑–∏–∫–∞", game: "–Ü–≥—Ä–∏", prod: "–†–æ–±–æ—Ç–∞", sec: "–ë–µ–∑–ø–µ–∫–∞", edu: "–ù–∞–≤—á–∞–Ω–Ω—è", other: "–Ü–Ω—à–µ" };
    const listContainer = document.getElementById('servicesList');

    // --- –ù–û–í–ê –õ–û–ì–Ü–ö–ê –§–Ü–õ–¨–¢–†–Ü–í –Ü –ü–û–®–£–ö–£ ---
    
    // 1. –§—É–Ω–∫—Ü—ñ—è, —è–∫–∞ —Å–ø—Ä–∞—Ü—å–æ–≤—É—î –ø—Ä–∏ –∫–ª—ñ–∫—É –Ω–∞ –∫–Ω–æ–ø–∫—É —Ñ—ñ–ª—å—Ç—Ä–∞
    function activateFilter(filterType, btnElement) {
        currentFilter = filterType;
        document.querySelectorAll('.chip').forEach(chip => chip.classList.remove('active'));
        btnElement.classList.add('active');
        renderServices();
    }

    // 2. –§—É–Ω–∫—Ü—ñ—è, —è–∫–∞ –º–∞–ª—é—î —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤—ñ—Å—ñ–≤
    function renderServices() {
        listContainer.innerHTML = '';
        
        const filtered = servicesData.filter(s => {
            const matchesCategory = currentFilter === 'all' || s.type === currentFilter;
            const matchesSearch = s.name.toLowerCase().includes(currentSearch.toLowerCase());
            return matchesCategory && matchesSearch;
        });

        filtered.sort((a, b) => a.name.localeCompare(b.name));

        filtered.forEach(service => {
            const card = document.createElement('div');
            card.className = 'service-card';
            card.onclick = () => openModal(service);
            const logoUrl = `https://logo.clearbit.com/${service.domain}`;
            
            card.innerHTML = `
                <div class="service-icon">
                    <img src="${logoUrl}" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
                    <span style="display:none; color:white; font-weight:bold;">${service.name[0]}</span>
                </div>
                <div class="service-info">
                    <div class="service-name">${service.name}</div>
                    <div class="service-meta"><span class="tag ${service.type}">${typeNames[service.type] || '–°–µ—Ä–≤—ñ—Å'}</span></div>
                </div>
                <div style="color: #444;">‚Ä∫</div>
            `;
            listContainer.appendChild(card);
        });
    }

    // --- –ú–û–î–ê–õ–¨–ù–Ü –í–Ü–ö–ù–ê ---
    let currentService = null;
    const modal = document.getElementById('reminderModal');
    const statsModal = document.getElementById('statsModal');

    function openModal(service) {
        currentService = service;
        document.getElementById('modalTitle').innerText = service.name;
        document.getElementById('modalImg').src = `https://logo.clearbit.com/${service.domain}`;
        document.getElementById('dateInput').valueAsDate = new Date();
        document.getElementById('timeInput').value = ''; // –û—á–∏—â–∞—î–º–æ —á–∞—Å
        document.getElementById('priceInput').value = '';
        document.getElementById('unsubCheckbox').checked = false;
        
        modal.classList.add('open');
        tg.HapticFeedback.impactOccurred('light'); 
    }

    function closeModal() { modal.classList.remove('open'); }
    
    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    function openStats() {
        updateUI();
        statsModal.classList.add('open');
        tg.HapticFeedback.impactOccurred('medium'); 
    }
    function closeStats() { statsModal.classList.remove('open'); }

    // --- –ó–ë–ï–†–ï–ñ–ï–ù–ù–Ø (–ö–õ–Æ–ß–û–í–ê –§–£–ù–ö–¶–Ü–Ø) ---
    function saveSubscription() {
    alert("–ö–Ω–æ–ø–∫–∞ —Å–ø—Ä–∞—Ü—é–≤–∞–ª–∞!"); // üëà –î–û–î–ê–ô–¢–ï –¶–ï–ô –†–Ø–î–û–ö
        const dateVal = document.getElementById('dateInput').value; // YYYY-MM-DD
        const timeVal = document.getElementById('timeInput').value; // HH:MM (–º–æ–∂–µ –±—É—Ç–∏ –ø–æ—Ä–æ–∂–Ω—ñ–º)
        const priceVal = parseFloat(document.getElementById('priceInput').value);
        const isUnsub = document.getElementById('unsubCheckbox').checked;

        if (!dateVal) return alert("–í–∫–∞–∂—ñ—Ç—å –¥–∞—Ç—É!");

        // üåü –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø: –û–±'—î–¥–Ω—É—î–º–æ –¥–∞—Ç—É —Ç–∞ —á–∞—Å
        let fullDate = dateVal;
        if (timeVal) {
            fullDate = dateVal + 'T' + timeVal;
        }

        // 1. –û–Ω–æ–≤–ª—é—î–º–æ –ª–æ–∫–∞–ª—å–Ω—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        if (!isNaN(priceVal)) {
            if (isUnsub) {
                userData.savings += priceVal;
            } else {
                userData.expenses += priceVal;
            }
            saveToLocal(); // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤ –ø–∞–º'—è—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω—É
        }

        // 2. –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –≤ –¢–µ–ª–µ–≥—Ä–∞–º (–¥–ª—è –±–æ—Ç–∞)
        const data = JSON.stringify({ 
            service: currentService.name, 
            date: fullDate, // üëà –ù–∞–¥—Å–∏–ª–∞—î–º–æ –æ–±'—î–¥–Ω–∞–Ω—É –¥–∞—Ç—É/—á–∞—Å
            price: priceVal || 0,
            status: isUnsub ? "cancelled" : "active",
        });
        
        // üåü –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø: –ù–∞–¥—ñ–π–Ω–∏–π –≤–∏–∫–ª–∏–∫ sendData, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –ø–æ–º–∏–ª–æ–∫
        if (window.Telegram.WebApp && window.Telegram.WebApp.sendData) {
            window.Telegram.WebApp.sendData(data);
        } else {
            alert("–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏: API Telegram WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π. –°–ø—Ä–æ–±—É–π—Ç–µ –≤ –º–æ–±—ñ–ª—å–Ω–æ–º—É –¥–æ–¥–∞—Ç–∫—É.");
        }
        
        closeModal();
    }

    // –ó–∞–∫—Ä–∏—Ç—Ç—è –ø–æ –∫–ª—ñ–∫—É –Ω–∞ —Ñ–æ–Ω
    document.querySelectorAll('.modal-overlay').forEach(overlay => {
        overlay.onclick = (e) => { if(e.target === overlay) { closeModal(); closeStats(); }};
    });
    
    // –°–ª—É—Ö–∞—á –ø–æ–¥—ñ–π –¥–ª—è –ü–û–®–£–ö–£
    document.getElementById('searchInput').addEventListener('input', (e) => {
        currentSearch = e.target.value;
        renderServices();
    });
    
</script>

</body>
</html>
